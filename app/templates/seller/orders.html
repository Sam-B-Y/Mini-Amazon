{% extends "base.html" %} {% block content %}

<div class="container my-5">
  <h2 class="mb-4 text-center">Seller Orders</h2>

  <div class="mb-4 d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center">
      <label for="orderStatusFilter" class="form-label me-2">
        <strong>Filter by Status:</strong>
      </label>
      <select
        id="orderStatusFilter"
        class="form-select w-auto"
        onchange="loadOrders()"
      >
        <option value="All">All</option>
        <option value="Pending">Pending</option>
        <option value="Shipped">Shipped</option>
        <option value="Complete">Complete</option>
        <option value="Cancelled">Cancelled</option>
      </select>
    </div>

    <div class="input-group" style="width: 50%;">
      <input
        type="text"
        id="orderSearchInput"
        class="form-control"
        placeholder="Search orders by buyer name, address, or order ID"
      />
      <button class="btn btn-primary" onclick="loadOrders()">Search</button>
    </div>
  </div>

  <div id="ordersContainer" class="row g-4"></div>
</div>

<script>
  async function loadOrders() {
    try {
      const statusFilter = document.getElementById("orderStatusFilter").value;
      const searchQuery = document.getElementById("orderSearchInput").value.trim();
      const ordersContainer = document.getElementById("ordersContainer");

      ordersContainer.innerHTML = "";

      // Construct API URL with search and status filters
      const response = await fetch(
        `/orders/api/seller_orders?status=${encodeURIComponent(statusFilter)}&search=${encodeURIComponent(searchQuery)}`
      );
      const data = await response.json();

      if (data.error) {
        console.error(data.error);
        ordersContainer.innerHTML =
          '<p class="text-danger text-center">Failed to load orders.</p>';
        return;
      }

      if (data.orders.length === 0) {
        ordersContainer.innerHTML =
          '<p class="text-muted text-center">No orders found.</p>';
        return;
      }

      data.orders.forEach((order) => {
        const badgeClass = getBadgeClass(order.order_status);

        const card = document.createElement("div");
        card.className = "col-lg-4 col-md-6 col-sm-12";
        card.innerHTML = `
          <div class="card shadow-sm border-0">
            <div class="card-header d-flex justify-content-between align-items-center bg-light">
              <span class="fw-bold">Order ID: ${order.order_id}</span>
              <span class="badge ${badgeClass}">${order.order_status}</span>
            </div>
            <div class="card-body">
              <p><strong>Buyer:</strong> ${order.buyer_name}</p>
              <p><strong>Address:</strong> ${order.buyer_address}</p>
              <p><strong>Date:</strong> ${new Date(
                order.ordered_time
              ).toLocaleDateString()}</p>
              <p><strong>Quantity:</strong> ${order.quantity}</p>
              <p><strong>Total:</strong> $${(
                order.quantity * order.unit_price
              ).toFixed(2)}</p>
            </div>
          </div>
        `;
        ordersContainer.appendChild(card);
      });
    } catch (error) {
      console.error("Error loading orders:", error);
    }
  }

  function getBadgeClass(status) {
    switch (status) {
      case "Pending":
        return "bg-warning text-dark";
      case "Shipped":
        return "bg-primary text-white";
      case "Complete":
        return "bg-success text-white";
      case "Cancelled":
        return "bg-danger text-white";
      default:
        return "bg-secondary text-white";
    }
  }

  // Load orders when the page loads
  loadOrders();
</script>

<style>
  .card {
    border-radius: 0.75rem;
    transition: transform 0.2s ease-in-out;
    margin-bottom: 15px;
  }

  .card:hover {
    transform: scale(1.02);
  }

  .card-header {
    font-size: 1rem;
    font-weight: bold;
  }

  .badge {
    padding: 0.5em 0.75em;
    font-size: 0.85rem;
  }

  #orderStatusFilter,
  #orderSearchInput {
    border-radius: 0.5rem;
  }
</style>

{% endblock %}
