{% extends "base.html" %} {% block content %}

<br /><br />

<h2 style="padding-left: 3vw">My Account:</h2>

<hr />

<div class="container-account">
  <div class="info">
    <h3>Personal Information</h3>
    <form action="/account" method="POST" class="form">
      <input type="hidden" name="form_id" value="full_name" />
      <h4 class="label">Full Name:</h4>
      <div class="field input-group">
        <input
          id="full_name"
          name="full_name"
          type="text"
          class="form-control"
          value="{{full_name}}"
          required
        />
      </div>
      <button type="submit" class="submit">
        <a class="btn btn-secondary"><i class="fa fa-edit"></i></a>
      </button>
    </form>
    <form action="/account" method="POST" class="form">
      <input type="hidden" name="form_id" value="email" />
      <h4 class="label">Email:</h4>
      <div class="field input-group">
        <input
          id="email"
          name="email"
          type="text"
          class="form-control"
          value="{{email}}"
          disabled
        />
      </div>
      <button type="submit" class="submit disabled" disabled>
        <a class="btn btn-secondary"><i class="fa fa-edit"></i></a>
      </button>
    </form>
    <form action="/account" method="POST" class="form">
      <input type="hidden" name="form_id" value="address" />
      <h4 class="label">Address:</h4>
      <div class="field input-group">
        <input
          id="address"
          name="address"
          type="text"
          class="form-control"
          value="{{address}}"
          required
        />
      </div>
      <button type="submit" class="submit">
        <a class="btn btn-secondary"><i class="fa fa-edit"></i></a>
      </button>
    </form>
    <form action="/account" method="POST" class="form">
      <input type="hidden" name="form_id" value="balance" />
      <h4 class="label">Balance:</h4>
      <div class="field input-group">
        <input
          id="balance"
          name="balance"
          type="number"
          step="0.01"
          class="form-control"
          value="{{balance}}"
          required
        />
      </div>
      <button type="submit" class="submit">
        <a class="btn btn-secondary"><i class="fa fa-edit"></i></a>
      </button>
    </form>
  </div>

  <div class="history">
    <h1>Purchase History</h1>
    {% for purchase in order_history %} {% for line_item in purchase %}
    <p>{{ line_item }}</p>
    {% endfor %} {% endfor %}
  </div>

  <!-- Button to redirect to Most Recent Reviews -->
  <div class="recent-reviews">
    <h1>Most Recent Reviews</h1>
    <button class="btn btn-primary" onclick="redirectToRecentReviews()">
      View Recent Reviews
    </button>
  </div>
</div>

<hr />
<h2 style="margin-left: 5%">Selling Inventory</h2>
<br />
<a href="/inventory" style="margin-left: 5%; width: 30%" class="btn btn-primary"
  >Seller Inventory Lookup</a
>
<br />
<table
  id="inventoryTable"
  border="1"
  style="width: 40%; margin-left: 5%; margin-top: 20px"
>
  <thead>
    <tr>
      <th>Inventory ID</th>
      <th>Seller ID</th>
      <th>Product ID</th>
      <th>Quantity</th>
      <th>Product Name</th>
      <th>Description</th>
      <th>Image</th>
      <th>Price</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(";").shift();
  }
  async function fetchInventory(userId) {
    try {
      const response = await fetch(`/api/inventory?user_id=${userId}`);
      if (!response.ok) throw new Error("Failed to fetch inventory");

      const inventory = await response.json();
      const tableBody = document
        .getElementById("inventoryTable")
        .querySelector("tbody");
      tableBody.innerHTML = "";

      inventory.forEach((item) => {
        const row = document.createElement("tr");
        row.innerHTML = `
                    <td>${item.inventory_id}</td>
                    <td>${item.seller_id}</td>
                    <td>${item.product_id}</td>
                    <td>${item.quantity}</td>
                    <td>${item.product_name}</td>
                    <td>${item.description}</td>
                    <td><img src="${item.image_url}" alt="Product Image" width="50"></td>
                    <td>${item.price}</td>
                `;
        tableBody.appendChild(row);
      });
    } catch (error) {
      console.error("Error loading inventory:", error);
    }
  }
  window.onload = function () {
    const userId = getCookie("id");
    if (userId) {
      fetchInventory(userId);
    } else {
      console.error("User ID cookie not found");
    }
  };
</script>

{% endblock %}
